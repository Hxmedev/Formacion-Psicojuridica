---
import Layout from '../layouts/Layout.astro';

const ApiBaseUrl = import.meta.env.REACT_APP_API_BASE_URL;
console.log('API Base URL:', ApiBaseUrl);  // Verifica si se carga correctamente
const response = await fetch(`${ApiBaseUrl}/api/cursos/get`);
const cursos = await response.json();

// Agrupar y ordenar cursos
const groupedCourses = cursos.reduce((acc: Record<string, typeof cursos[0][]>, curso: typeof cursos[0]) => {
  const category = curso.category || 'General';
  acc[category] = acc[category] || [];
  acc[category].push(curso);
  return acc;
}, {} as Record<string, typeof cursos[0][]>);

const sortedCategories = Object.keys(groupedCourses).sort();
---

<Layout>
  <!-- Hero Section -->
  <section class="relative bg-gradient-to-b from-blue-700 to-blue-600 text-white py-24 overflow-hidden">
    <div class="absolute inset-0 opacity-10">
      <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiPjxkZWZzPjxwYXR0ZXJuIGlkPSJwYXR0ZXJuIiB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHBhdHRlcm5Vbml0cz0idXNlclNwYWNlT25Vc2UiIHBhdHRlcm5UcmFuc2Zvcm09InJvdGF0ZSg0NSkiPjxyZWN0IHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgZmlsbD0icmdiYSgyNTUsMjU1LDI1NSwwLjA1KSIvPjwvcGF0dGVybj48L2RlZnM+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0idXJsKCNwYXR0ZXJuKSIvPjwvc3ZnPg==')]"></div>
    </div>
    <div class="max-w-6xl mx-auto px-6 text-center relative z-10">
      <h1 class="text-4xl md:text-5xl font-light leading-tight mb-6">Formación <span class="font-semibold">Especializada</span></h1>
      <div class="w-24 h-1 bg-blue-400 mx-auto mb-8"></div>
      <div class="max-w-3xl mx-auto space-y-4 text-lg text-blue-50 leading-relaxed">
        <p>Programas diseñados para profesionales que buscan profundizar en áreas específicas de conocimiento.</p>
        <p>Combinamos rigor académico con aplicabilidad práctica en un formato flexible.</p>
      </div>
    </div>
  </section>

  <!-- Features Section -->
  <section class="bg-white py-16">
    <div class="max-w-7xl mx-auto px-6 grid md:grid-cols-3 gap-8">
      <div class="text-center p-6">
        <div class="inline-flex items-center justify-center w-16 h-16 bg-blue-100 rounded-full mb-4 mx-auto">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
          </svg>
        </div>
        <h3 class="text-xl font-medium text-gray-800 mb-3">Contenido Actualizado</h3>
        <p class="text-gray-600">Programas revisados periódicamente para incorporar los últimos desarrollos.</p>
      </div>
      
      <div class="text-center p-6">
        <div class="inline-flex items-center justify-center w-16 h-16 bg-blue-100 rounded-full mb-4 mx-auto">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
          </svg>
        </div>
        <h3 class="text-xl font-medium text-gray-800 mb-3">Expertos en la Materia</h3>
        <p class="text-gray-600">Profesionales con amplia experiencia práctica y docente.</p>
      </div>
      
      <div class="text-center p-6">
        <div class="inline-flex items-center justify-center w-16 h-16 bg-blue-100 rounded-full mb-4 mx-auto">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
          </svg>
        </div>
        <h3 class="text-xl font-medium text-gray-800 mb-3">Certificación</h3>
        <p class="text-gray-600">Diplomas con validez profesional al completar los requisitos.</p>
      </div>
    </div>
  </section>

  <!-- Courses by Category -->
  <section class="bg-gray-50 py-16">
    <div class="max-w-7xl mx-auto px-6">
      <div class="space-y-16">
        {sortedCategories.map((category) => (
          <div key={category}>
            <div class="flex items-center mb-10">
              <h2 class="text-lg font-normal text-gray-700">{category}</h2> <!-- Títulos más pequeños -->
              <div class="flex-1 ml-4 h-px bg-gradient-to-r from-blue-400 to-transparent"></div>
            </div>
            
            <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
              {groupedCourses[category].map((course) => (
                <div class="group bg-white rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow duration-300 border border-gray-100 flex flex-col h-full">
                  <div class="relative overflow-hidden" style="height: 45%;"> <!-- Imagen ocupa 45% -->
                    <img 
                      src={course.imageUrl || 'https://www.shutterstock.com/image-vector/default-image-icon-vector-missing-600nw-2079504220.jpg'} 
                      alt={course.title} 
                      class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
                    />
                    <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent">
                    </div>
                    <div class="absolute bottom-0 left-0 p-4">
                      <span class="inline-block px-3 py-1 bg-blue-600 text-white text-xs font-medium rounded-full">
                        {course.duration || 'Flexible'}
                      </span>
                    </div>
                  </div>
                  
                  <!-- Contenido que ocupa el 55% restante -->
                  <div class="p-6 flex flex-col flex-grow">
                    <h4 class="font-medium text-gray-800 group-hover:text-blue-600 transition-colors mb-2" style="font-size: 1.35em;">
                      {course.title}
                    </h4>
                    
                    <p class="text-gray-600 text-sm mb-4 line-clamp-2">
                      {course.description}
                    </p>
                    
                    <!-- Sección pegada al fondo -->
                    <div class="mt-auto">
                      <div class="flex items-center text-sm text-gray-500 mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                        {course.instructor || 'Equipo docente'}
                      </div>
                      
                      <div class="flex justify-between items-center pt-4 border-t border-gray-100">
                        {course.price ? (
                          <span class="text-lg font-medium text-gray-900">
                            {course.price}
                          </span>
                        ) : (
                          <span class="text-sm font-medium text-blue-600">
                            Consultar precio
                          </span>
                        )}
                        
                        <a 
                          href={course.link || '/contacto'} 
                          class="inline-flex items-center text-sm font-medium text-blue-600 hover:text-blue-800 transition-colors"
                        >
                          Más información
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                          </svg>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>


  <!-- CTA Section -->
  <section class="bg-blue-700 text-white py-16">
    <div class="max-w-4xl mx-auto px-6 text-center">
      <h2 class="text-2xl md:text-3xl font-light mb-6">¿Necesitas un programa a medida para tu equipo?</h2>
      <p class="text-lg text-blue-100 mb-8 max-w-2xl mx-auto">Desarrollamos cursos personalizados según las necesidades específicas de tu organización.</p>
      <a 
        href="/contacto" 
        class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-blue-700 bg-white hover:bg-gray-50 transition-colors"
      >
        Solicitar información
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
        </svg>
      </a>
    </div>
  </section>
</Layout>